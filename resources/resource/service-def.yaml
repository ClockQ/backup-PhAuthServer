models:
- PhAccount
- PhEmployee
- PhGroup
- PhCompany
- PhRole

storages:
- name: PhAccountStorage
  method: NewStorage
  daemons:
  - BmMongodbDaemon
- name: PhEmployeeStroage
  method: NewStorage
  daemons:
  - BmMongodbDaemon
- name: PhGroupStroage
  method: NewStorage
  daemons:
  - BmMongodbDaemon
- name: PhCompanyStroage
  method: NewStorage
  daemons:
  - BmMongodbDaemon
- name: PhRoleStroage
  method: NewStorage
  daemons:
  - BmMongodbDaemon

resources:
- name: PhAccountResource
  method: NewResource
  storages:
  - PhAccountStorage
  - PhEmployeeStroage
  - PhRoleStroage
- name: PhEmployeeResource
  method: NewResource
  storages:
  - PhEmployeeStroage
  - PhGroupStroage
- name: PhGroupResource
  method: NewResource
  storages:
  - PhEmployeeStroage
  - PhGroupStroage
  - PhCompanyStroage
- name: PhCompanyResource
  method: NewResource
  storages:
  - PhGroupStroage
  - PhCompanyStroage
- name: PhRoleResource
  method: NewResource
  storages:
  - PhRoleStroage

services:
- name: ph-account
  model: PhAccount
  resource: PhAccountResource
- name: ph-employee
  model: PhEmployee
  resource: PhEmployeeResource
- name: ph-group
  model: PhGroup
  resource: PhGroupResource
- name: ph-company
  model: PhCompany
  resource: PhCompanyResource

functions:
- name: PhLoginPageHandler
  create: NewLoginPageHandler
  method: Login
  http: GET
  args:
  - static/login.html
- name: PhAuthPageHandler
  create: NewAuthPageHandler
  method: Auth
  http: GET
  args:
  - static/auth.html
- name: PhAccountHandler
  create: NewAccountHandler
  daemons:
  - BmMongodbDaemon
  - BmRedisDaemon
  method: AccountValidation
  http: POST
  args:
  - Auth
  - Authorize
#  - http://192.168.100.174:9096
  - http://oauth.pharbers.com
- name: PhTokenHandler
  create: NewTokenHandler
  daemons:
  - BmMongodbDaemon
  - BmRedisDaemon
  method: Token
  http: POST
- name: PhTokenValidationHandler
  create: NewTokenHandler
  daemons:
  - BmMongodbDaemon
  - BmRedisDaemon
  method: TokenValidation
  http: POST
- name: PhAuthorizeHandler
  create: NewAuthorizeHandler
  daemons:
  - BmMongodbDaemon
  - BmRedisDaemon
  method: Authorize
  http: GET
- name: PhUserAgentHandler
  create: NewUserAgentHandle
  daemons:
  - BmMongodbDaemon
  - BmRedisDaemon
  method: ThirdParty
  http: GET
  args:
  - name
- name: PhGenerateAccessTokenHandler
  create: NewAuthorizeHandler
  daemons:
  - BmMongodbDaemon
  - BmRedisDaemon
  method: GenerateAccessToken
  http: GET
- name: PhRefreshAccessTokenHandler
  create: NewAuthorizeHandler
  daemons:
  - BmMongodbDaemon
  - BmRedisDaemon
  method: RefreshAccessToken
  http: GET
- name: PhPasswordLoginHandler
  create: NewAuthorizeHandler
  daemons:
  - BmMongodbDaemon
  - BmRedisDaemon
  method: PasswordLogin
  http: POST


middlewares:
- name: PhCheckTokenMiddleware
  create: NewCheckTokenMiddleware
  daemons:
  - BmMongodbDaemon
  - BmRedisDaemon
  args:
  - name

panic:
  name: PhCommonPanicHandle
  create: NewCommonPanicHandle

daemons:
- name: BmMongodbDaemon
  method: NewMongoDBDaemon
  args:
    host: primary
    port: 27017
    database: pharbers-auth-server
#    host: 192.168.100.174
#    port: 27017
#    database: jeo_test
- name: BmRedisDaemon
  method: NewRedisDBDaemon
  args:
    host: redis
    port: 6379
#    host: 192.168.100.174
#    port: 6379
    password:
    database: 0
